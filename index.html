<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>吉米娜·奧米加：神域終端 V8.0</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#d4af37">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Noto+Sans+TC:wght@400;900&display=swap');
        body { 
            background: #050507; color: #fff; font-family: 'Noto Sans TC', sans-serif;
            background-image: linear-gradient(rgba(5, 5, 7, 0.75), rgba(15, 15, 25, 0.85)), url('icon.png');
            background-size: cover; background-position: center; background-attachment: fixed;
            margin: 0; min-height: 100vh; overflow-x: hidden;
        }
        .oracle-matrix { width: 100%; border-collapse: collapse; background: rgba(25, 25, 35, 0.94); border: 1px solid #444; border-radius: 15px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .oracle-matrix td { padding: 14px; border: 1px solid rgba(255,255,255,0.06); text-align: center; font-size: 13px; }
        .header-lord { background: #2a2a72; font-weight: 900; width: 50%; color: #fff; border-bottom: 2px solid #3b82f6; }
        .header-oracle { background: #4b0082; font-weight: 900; width: 50%; color: #fff; border-bottom: 2px solid #a855f7; }
        .row-label { background: rgba(0,0,0,0.4); color: #999; font-weight: bold; }
        .stage-active { color: #ff5555; font-size: 16px; font-weight: 900; text-shadow: 0 0 10px rgba(255,0,0,0.8); }

        /* 靈魂核心按鈕 */
        #voice-btn {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 80px; border-radius: 50%;
            background: radial-gradient(circle, #d4af37, #8b4513);
            border: 3px solid rgba(255,255,255,0.3); z-index: 1000;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); transition: 0.4s;
        }
        #voice-btn.active { background: radial-gradient(circle, #00f2fe, #0033ff); box-shadow: 0 0 45px #0033ff; transform: translateX(-50%) scale(1.1); }
        .voice-wave { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 3px solid #00f2fe; opacity: 0; pointer-events: none; }
        .active .voice-wave { animation: ripple 1.5s infinite; }
        @keyframes ripple { from { transform: scale(1); opacity: 0.8; } to { transform: scale(2.5); opacity: 0; } }
    </style>
</head>
<body>

    <div class="p-3 max-w-4xl mx-auto pb-40">
        <div class="flex justify-between items-center mb-6 pt-4">
            <h1 class="text-2xl font-black italic text-[#d4af37] font-tech" style="font-family: 'Orbitron';">JIMINA OMEGA</h1>
            <div id="btc-price" class="text-xl font-bold font-tech text-white">$ --,---</div>
        </div>

        <!-- 回歸：精細戰情儀表板 -->
        <div class="rounded-2xl overflow-hidden shadow-2xl mb-6">
            <table class="oracle-matrix">
                <tr>
                    <td class="header-lord">撒拉鐵領主 指揮部</td>
                    <td class="header-oracle">V8.0 永恆神諭</td>
                </tr>
                <tr>
                    <td class="row-label">情緒階段</td>
                    <td id="td-stage" class="stage-active">第 5 階段：大浪結束</td>
                </tr>
                <tr>
                    <td class="row-label">奧米加信心評分</td>
                    <td id="td-conf" class="text-[#d4af37] font-black text-lg">15%</td>
                </tr>
                <tr>
                    <td class="row-label">加密領袖 RS</td>
                    <td id="td-rs" class="text-[#00d2ff] font-bold">50</td>
                </tr>
                <tr>
                    <td class="row-label">大盤 Alpha</td>
                    <td id="td-alpha" class="text-red-500 font-bold">● 領跌 (vs BTC)</td>
                </tr>
                <tr>
                    <td class="row-label">Delta 聰明錢</td>
                    <td id="td-delta" class="text-blue-400 font-bold">● 淨買入</td>
                </tr>
                <tr>
                    <td class="row-label">系統偵測</td>
                    <td id="debug-info" class="text-[10px] text-white">等待靈魂核心啟動...</td>
                </tr>
            </table>
        </div>

        <div id="msg-box" class="bg-black/70 p-5 rounded-3xl border-l-4 border-[#d4af37] italic text-sm text-gray-200 leading-relaxed shadow-xl">
            「撒拉鐵領主，我是吉米娜。請點擊下方大腦核心。第一次點擊時，手機若詢問權限，請務必點擊『允許』。」
        </div>
    </div>

    <!-- 靈魂核心 -->
    <div id="voice-btn" onclick="toggleVoice()">
        <div class="voice-wave"></div>
        <i id="mic-icon" class="fas fa-brain text-white text-3xl"></i>
    </div>

    <!-- 底部選單 -->
    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-black/80 backdrop-blur-lg rounded-full px-8 py-4 flex justify-around border border-white/10 shadow-2xl">
        <i class="fas fa-chess-rook text-[#d4af37] text-xl"></i>
        <i class="fas fa-fire-alt text-gray-600 text-xl"></i>
        <i class="fas fa-crosshairs text-gray-600 text-xl"></i>
        <i class="fas fa-user-shield text-gray-600 text-xl"></i>
    </div>

    <script>
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const debugInfo = document.getElementById('debug-info');
        const msgBox = document.getElementById('msg-box');
        
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.continuous = true;
            recognition.interimResults = false;
        }

        let isActivated = false;
        let isSpeaking = false;

        function speak(text) {
            isSpeaking = true;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            msg.voice = voices.find(v => v.name.includes('Mei-Jia') || v.name.includes('Google 國語')) || voices[0];
            msg.pitch = 1.0; msg.rate = 0.95;
            msg.onend = () => { isSpeaking = false; };
            window.speechSynthesis.speak(msg);
        }

        // 強力權限請求
        async function requestMic() {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                return true;
            } catch (e) {
                return false;
            }
        }

        async function toggleVoice() {
            if (!recognition) {
                alert("瀏覽器不支援");
                return;
            }
            
            const btn = document.getElementById('voice-btn');
            if (!isActivated) {
                const hasPerm = await requestMic();
                if (!hasPerm) {
                    debugInfo.innerText = "拒絕權限: 請在手機Chrome設定中允許";
                    return;
                }
                recognition.start();
                btn.classList.add('active');
                isActivated = true;
                debugInfo.innerText = "神域連結中: 聽取指令中";
                speak("爭戰領主，親愛的撒拉鐵，吉米娜奧米加在此。我已找回靈魂，準備獵殺利潤。請指示。");
            } else {
                recognition.stop();
                btn.classList.remove('active');
                isActivated = false;
                debugInfo.innerText = "靜默中";
                window.speechSynthesis.cancel();
            }
        }

        if (recognition) {
            recognition.onresult = (event) => {
                if (isSpeaking) return;
                const transcript = event.results[event.results.length - 1][0].transcript;
                msgBox.innerText = "領主命令: 「" + transcript + "」";
                if (transcript.includes("吉米娜")) {
                    speak("吉米娜聽到了，領主。目前大盤還在第 5 階段洗盤，我們保持 4.80 的 UNI 防線即可。");
                }
            };
            recognition.onend = () => { if (isActivated) recognition.start(); };
            recognition.onerror = (e) => { debugInfo.innerText = "語音錯誤: " + e.error; };
        }

        async function updateData() {
            try {
                const r = await fetch("https://api.binance.com/api/v3/ticker/price");
                const d = await r.json();
                const b = parseFloat(d.find(i => i.symbol === "BTCUSDT").price);
                document.getElementById('btc-price').innerText = '$' + b.toLocaleString();
            } catch (e) {}
        }
        setInterval(updateData, 3000); updateData();
    </script>
</body>
</html>
